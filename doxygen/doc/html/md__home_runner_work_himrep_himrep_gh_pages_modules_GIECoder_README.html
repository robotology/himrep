<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>himrep: Table of Contents</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">himrep
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Table of Contents </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#description">Description</a></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#compilation">Compilation</a></li>
</ul>
</li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#download-binary-caffe-models-caffemodel">Download binary Caffe models (.caffemodel)</a></li>
<li><a href="#configure-ini">Configure .ini</a></li>
</ul>
</li>
<li><a href="#detailed-explanation">Detailed explanation</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
Description</h1>
<p>This module is a basic YARP wrapper for <a href="https://developer.nvidia.com/tensorrt">TensorRT</a>, which receives as input a stream of images (of type <code>yarp::sig::Image</code>), feeds them to a Convolutional Neural Network (CNN) model and produces as output a corresponding stream of vectors (of type <code>yarp::sig::Vector</code>), which can be extracted from any CNN layer.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md22"></a>
Dependencies</h2>
<p>The libraries that are needed to compile this module are:</p>
<ul>
<li><a href="https://github.com/robotology/yarp">YARP</a></li>
<li><a href="https://github.com/robotology/icub-main">iCub</a></li>
<li><a href="http://opencv.org/releases.html">OpenCV</a></li>
<li><a href="https://developer.nvidia.com/tensorrt">TensorRT</a></li>
<li><a href="https://developer.nvidia.com/cuda-zone">CUDA</a> and <a href="https://developer.nvidia.com/cudnn">cuDNN</a>: these are dependencies of TensorRT and also of the module itself</li>
</ul>
<h2><a class="anchor" id="autotoc_md23"></a>
Compilation</h2>
<p>Provided that the dependencies are satified, you can compile this module just by setting the <code>BUILD_GIECoder</code> flag to <code>ON</code> as explained <a href="https://www.github.com/robotology/himrep/README/#compilation">here</a>.</p>
<p>When you run the <code>ccmake</code> command, ensure also that:</p>
<ul>
<li><code>TensorRT</code> is correctly found on the system</li>
<li>the flag <code>CUDA_USE_STATIC_CUDA_RUNTIME</code> is set to <code>OFF</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Setup</h1>
<p>This module can use arbitrary Caffe models. In the following, we report istructions on how to setup the module to use either one of two well-known models, <code>ResNet-50</code> and <code>CaffeNet</code>.</p>
<p>If you are not interested in the details, you can execute the following instructions and use one of these two models with the default module parameters. We provide a little more explanataion hereafter for those who want to try different or custom Caffe models and settings.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Download binary Caffe models (.caffemodel)</h2>
<p>If you don't have setted it already, for convenience, set the <code>Caffe_ROOT</code> env variable pointing to your <code>caffe</code> source code directory.</p>
<p>For <code>CaffeNet</code> we can follow the instructions on <a href="http://caffe.berkeleyvision.org/model_zoo.html">caffe</a> website:</p>
<div class="fragment"><div class="line">$ cd $Caffe_ROOT</div>
<div class="line">$ scripts/download_model_binary.py models/bvlc_reference_caffenet</div>
<div class="line"># for this model we need also to get the mean image of the training set of ILSVRC </div>
<div class="line">$ ./data/ilsvrc12/get_ilsvrc_aux.sh</div>
</div><!-- fragment --><p>For <code>ResNet-50</code> we can get the weights as indicated <a href="https://github.com/KaimingHe/deep-residual-networks">here</a>:</p>
<div class="fragment"><div class="line">$ cd $Caffe_ROOT/models</div>
<div class="line">$ mkdir ResNet50</div>
<div class="line">$ cd ResNet50</div>
</div><!-- fragment --><p>by downloading, in this folder, the <code>ResNet-50-model.caffemodel</code> and the <code>ResNet-50-deploy.prototxt</code> files from the <a href="https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&amp;id=4006CBB8476FF777%2117887&amp;cid=4006CBB8476FF777">OneDrive link</a> specified at the webpage.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Configure .ini</h2>
<p>We have now to customize the module's <code>.ini</code> file in order to use the downloaded Caffe model. Some <code>.ini</code> examples are provided (e.g. for the two networks considered here plus <code>GoogLeNet</code>) with the source code of the module (inside <code>app/conf</code>). Therefore we can import such <code>.ini</code> files from <code>himrep</code> for the <code>CaffeNet</code> and <code>ResNet-50</code> by doing:</p>
<div class="fragment"><div class="line"># CaffeNet</div>
<div class="line">$ yarp-config context --import himrep caffeCoder_caffenet.ini</div>
<div class="line">$ yarp-config context --import himrep caffeCoder_resnet.ini</div>
</div><!-- fragment --><p>For each of them we must set the following variables to the correct paths: <code>caffemodel_file</code> and <code>prototxt_file</code>.</p>
<p>For <code>CaffeNet</code> do:</p>
<div class="fragment"><div class="line">$ cd ~/.local/share/yarp/contexts/himrep</div>
<div class="line">$ gedit caffeCoder_caffenet.ini</div>
</div><!-- fragment --><p>And then set:</p>
<div class="fragment"><div class="line">caffemodel_file $Caffe_ROOT/models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel</div>
<div class="line">prototxt_file $Caffe_ROOT/models/bvlc_reference_caffenet/deploy.prototxt</div>
</div><!-- fragment --><p>replacing the <code>$Caffe_ROOT</code> env variable with its full value.</p>
<p>For <code>ResNet-50</code> do:</p>
<div class="fragment"><div class="line">gedit caffeCoder_resnet.ini</div>
</div><!-- fragment --><p>And then set:</p>
<div class="fragment"><div class="line">caffemodel_file $Caffe_ROOT/models/ResNet-50/ResNet-50-model.caffemodel</div>
<div class="line">prototxt_file $Caffe_ROOT/models/ResNet-50/ResNet-50-deploy.prototxt</div>
</div><!-- fragment --><p>replacing the <code>$Caffe_ROOT</code> env variable with its full value.</p>
<p>For other parameters and input and output ports we refer to the module documentation <a href="http://robotology.github.io/himrep/doxygen/doc/html/group__GIECoder.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Detailed explanation</h1>
<p>In Caffe, the weights of network models are stored in a <code>.caffemodel</code> file, whose absolute path must be provided to the <code>GIECoder</code> in the <code>caffemodel_file</code> parameter. The network definition file to be used in inference mode instead is usually the <code>deploy.prototxt</code> and its absolute path must be provided to the <code>GIECoder</code> in the <code>prototxt_file</code> parameter.</p>
<p>In Caffe's <a href="http://caffe.berkeleyvision.org/model_zoo.html">Model Zoo</a> there are many models available with related descriptions and usage instructions. You can use them with <code>GIECoder</code>, just by passing the path to their <code>deploy.prototxt</code> (and ensuring that TensorRT can convert them correctly, by checking, e.g., that there are no layer kinds which are not supported by the engine).</p>
<p>In order to correctly use a network in inference mode, the mean image (or pixel) of the training set that has been used to learn the model parameters must be subtracted from any image that is fed to the model. The mean image is usully stored in Caffe with a <code>.binaryproto</code> file. You will need to specify this information in the <code>.ini</code>:</p>
<ul>
<li>if the mean image is subtracted, the <code>.binaryproto</code> file must be pointed by the <code>binaryproto_meanfile</code> parameter;</li>
<li>if the mean pixel is subtracted, you will need to specify, in the <code>.ini</code> file, five additional parameters: three of them are the R, G, B, values of the pixel (<code>meanR</code>, <code>meanG</code>, <code>meanB</code>) and two of them are the width and height to which the input image will be resized before being fed to the network (<code>resizeWidth</code> and <code>resizeHeight</code>).</li>
</ul>
<p>Another important parameter to be set in the <code>.ini</code> file is the tag/name of the output of the layer we want to read. This can be specified by setting the <code>blob_name</code> parameter.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
License</h1>
<p>Material included here is Copyright of <em>iCub Facility - Istituto Italiano di Tecnologia</em> and is released under the terms of the GPL v2.0 or later. See the file LICENSE for details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
